<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Members Price Tag Generator</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Barlow+Condensed:wght@400;600;700;800&family=Montserrat:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <style>
      @font-face {
        font-family: 'FontNumbers';
        src: url('data:font/woff2;base64,d09GMgABAAAAAAWgAA0AAAAACtgAAAVQAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAABlYATBEICo4QimEBNgIkA0ALIgAEIAWBdAcgFyQYKBskCAAeh7Hb5IDG+lWoiJE90aY/b3c54C4qhF6UqBCvC1alVEyhdUgdb52kX0SEBgiwQpz//mxHl6k3+9+p0D+2RvCIreyXXq3TW7OahhGJ9eYNgwlQAGMaAMmj5pwTDrZW314Aoul0HBromJfdC6APPps+REMMYNBwHOocL5+8aMQCDEatGFfjZjO4iicBECoHk6ll4CCYLWB+jAwdGBhqtVuDWByAk+t/En/Nq84JhFaB4sDATIFVnSwwV5z1o1YTiBDYDERhUQ4Gf02h0yXlVCXwYVNUbaWqTlLz1EF2BfI7PjC3l/ibR4h7+sCcdiHP6C/pL7HfURV6wP7GG0Qe2QvYyKP4XgPcr1oUJNgtcL+m+BgqN7fSHbfUttc5kaLt4rIMuMtLTsWhWOQrQd+S7BbF6bLaLNeY7mi5Kvc6i8Wf4c+4svnRkd6y22ujxnODyA6rGwEEMgO+7FC2h0JEniwPBbOC3gx/hjvDDchOX+nAfbmB3AgsHg8PJQv5NbN2DN/QFurdtxXUhQDglr7Ej/C9Jf3essv35wXzot1g/uns01UhU+itmQxHpn3NoNOPaMCZaJ0lz7R8sI1E3Dnhe0sGrkP0OjWDdgjcYGo3HzC95pAroJSUDcF5XuVxveHoAna3Z4cSXdvs92bdbgzmBXdjvjRw6fQDpitSdDC4c8IZ4XtL3o5pUtCFzMwRuaE+7sscSFk6XOL3MmrmvVjld7JzwXwkkOIjkkkhzxtYHLC8Mt0KZLhz+LE9104c+KvNONc4fvT+d4ZHysLDw2W41bqI7CdxX4J52Sm+Kf/D+TFIIxafm3yVOb2gIL9g+K684r2xf0/93+h6h12ctO3sgvHwPrPDUDRmwtAJ1nFDx9hNH1Zrah+uyR4+unfyuWPVO4YYcvMMrvysUpcpK3+ZwZBvQN/UK/jmCuEqxSbv5ksOXPto291mNE7DMfckYyfHfJGb9GF8JB9PK5K6OqbXJtUMNqb9tvnS4AUazc5chqkS56xsXYo2ZV0ZE0zqk5go+0txLuk9uGTvao1YI+OllKJDBhLUonCJdd4yRD/klk6mEUoLZ4y7pJW/FWtu+LtTJJrqTAl6LRERo4gtXL4tJ7zo8BwDNb3URPnOw43vf/f7CKvccMs4JglliiIkNu6WhupzAdtoDA2lR0Jf3EBw2g9mbxl+0DXdtZ8vcfy8cU9gz+amzTn7yhc3HVwXWLfxZ4cjfePaGWs2D98ybYa+wbXDuTJE4RrWeUu9fnCs5gt5iCwiMfErk0oHF0J2cBr0Q1hccTxV8I4Y3saW8vDCw+OzUPgCEtQqu3XUrfVy/a2daZKQW2NGc8m/3VRrStRLxEAchxeFcyquwhpfDCvOQ6V163h5SGxDsrd/sDqdX9pG58ajoO975Yzj/9je+r1XRTuqd1R3RK/CHzzl9mZyzVw5UauuKyfBtQd0XFD5OrUM7eHoDmg/aA9Wz1+wfEFiXp7d5DIdGTd5jD2yc+iu3FmG/ALDwGLX4mGGtcAF0/wy/H7kPq8zues3XRX/EgA+2fn6g3DbG7b4cTNllKsAdGCQxPxHwE1rOej/Hd4GhEswJSPEhB7cAEFrQSc0gRaSgIGRSjqNPnzCH9WANBEQZ4BhKncNthORMJFjlIQehDTAxQxJSBNzOKCKBYy2iDVIEcQS7bXDsBqrsQaqkViNVdiAidiIlZiHhViH9YMOjqzD4jqmavwha6k6qDrGD0a+SoN6NRA0agaon6dZ1mGD8VKOfag4Lr9EKaBflzGDfxk3A1cBECqe4GZkuMq/nJXN7DiewpP4uVFfZ+kUngQA') format('woff2'),
          url('data:font/ttf;base64,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') format('truetype');
        font-weight: 400;
        font-style: normal;
        font-display: swap;
      }

      @font-face {
        font-family: 'CoopHeadline';
        src: url('fonts/CoopHeadline-Bold.ttf') format('truetype');
        font-weight: 700;
        font-style: normal;
        font-display: swap;
      }

      :root {
        --page-width: 21cm;
        --page-height: 29.7cm;
        --page-padding-top: 1.9cm;
        --page-padding-right: 0cm;
        --page-padding-bottom: 1.9cm;
        --page-padding-left: 0cm;
        --column-gap: 0cm;
        --row-gap: 0cm;
        --tag-width: 10.5cm;
        --layout-offset: 0cm;
        --tag-width-first: var(--tag-width);
        --tag-width-second: var(--tag-width);
        --column-template: var(--tag-width-first) var(--tag-width-second);
        --tag-height: 3.7cm;
        --tag-bg: #00A1CC;
        --tag-text: #ffffff;
        --pill-bg: #ffffff;
        --pill-text: #111827;
        --body-font: 'Montserrat', 'Helvetica Neue', Arial, sans-serif;
        --display-font: 'FontNumbers', 'Barlow Condensed', 'Impact', sans-serif;
        --heading-font: 'CoopHeadline', 'Impact', 'Impact Regular', 'Barlow Condensed', 'Arial Black', sans-serif;
        --heading-height-scale: 1.15;
        --tag-heading-size: 0.52cm;
        --price-scale: 1;
        --unit-height-scale: 1;
        --expiry-height-scale: 1;
        --product-name-scale: 1;
        --a4-heading-font-size: 3.175cm;
        --a4-heading-letter-spacing: 0em;
        --a4-heading-margin-bottom: 2.42cm;
        --a4-price-font-size: 5.161cm;
        --a4-price-letter-spacing: -0.002em;
        --a4-price-margin-top: -0.5cm;
        --a4-unit-font-size: 0.851cm;
        --a4-unit-letter-spacing: 0.01em;
        --a4-unit-margin-top: 2.5cm;
        --a4-end-font-size: 0.462cm;
        --a4-end-letter-spacing: 0.01em;
        --a4-end-margin-top: 0cm;
        --a4-end-date-letter-spacing: 0.02em;
        --a4-product-font-size: 1.168cm;
        --a4-product-letter-spacing: 0.012em;
        --a4-product-margin-top: 2.64cm;
        --a4-product-translate-x: -2cm;
      }

      *,
      *::before,
      *::after {
        box-sizing: border-box;
      }

      body {
        margin: 0;
        font-family: var(--body-font);
        background: #f3f4f6;
        color: #111827;
        min-height: 100vh;
        display: flex;
        flex-direction: column;
      }

      header {
        background: #0f172a;
        color: #ffffff;
        padding: 1.5rem 2.5rem;
        font-weight: 700;
        letter-spacing: 0.12em;
        text-transform: uppercase;
        font-size: 1.1rem;
        box-shadow: 0 18px 40px rgba(15, 23, 42, 0.24);
      }

      main {
        flex: 1;
        display: flex;
        flex-direction: column;
        gap: 2rem;
        padding: 2rem 2.5rem 3rem;
        align-items: center;
      }

      body[data-paper-size='large'] {
        --tag-width: 10.5cm;
        --tag-width-first: var(--tag-width);
        --tag-width-second: var(--tag-width);
        --column-template: var(--tag-width-first) var(--tag-width-second);
        --tag-height: 3.7cm;
        --product-name-scale: 1;
      }

      body[data-paper-size='normal'] {
        --tag-width: 7cm;
        --tag-width-first: var(--tag-width);
        --tag-width-second: var(--tag-width);
        --column-template: var(--tag-width-first) var(--tag-width-second) var(--tag-width);
        --tag-height: 3.76cm;
        --product-name-scale: 0.8;
        --tag-heading-size: 0.45cm;
      }

      body[data-paper-size='a4-single'] {
        --page-padding-top: 2.525cm;
        --page-padding-right: 2.39cm;
        --page-padding-bottom: 4.275cm;
        --page-padding-left: 2.442cm;
        --body-font: 'Avenir Next', 'Avenir Next Regular', 'Avenir Next LT Pro', 'Avenir',
          'Helvetica Neue', Arial, sans-serif;
        --column-gap: 0cm;
        --row-gap: 0cm;
        --tag-width: 16.42cm;
        --tag-width-first: var(--tag-width);
        --tag-width-second: var(--tag-width);
        --column-template: var(--tag-width-first);
        --tag-height: 22.9cm;
        --tag-bg: #ffffff;
        --tag-text: #111827;
        --heading-height-scale: 1;
        --price-scale: 1;
        --unit-height-scale: 1;
        --expiry-height-scale: 1;
        --product-name-scale: 1.1;
        --tag-heading-size: var(--a4-heading-font-size);
      }

      body[data-layout-mode='full-bleed']:not([data-paper-size='a4-single']) {
        --layout-offset: 0cm;
        --page-padding-left: 0cm;
        --tag-width-first: var(--tag-width);
      }

      body[data-layout-mode='hp-offset']:not([data-paper-size='a4-single']) {
        --layout-offset: 0.5cm;
        --page-padding-left: var(--layout-offset);
        --tag-width-first: calc(var(--tag-width) - var(--layout-offset));
      }

      body[data-layout-mode='hp-offset'][data-paper-size='large'] {
        --column-template: var(--tag-width-first) var(--tag-width-second);
      }

      body[data-layout-mode='hp-offset'][data-paper-size='normal'] {
        --column-template: var(--tag-width-first) var(--tag-width-second) var(--tag-width);
      }

      @media (max-width: 720px) {
        main {
          padding: 1.5rem;
        }

        header {
          padding: 1.25rem 1.5rem;
        }

        .row-controls {
          flex-direction: column;
          align-items: stretch;
          gap: 1.25rem;
        }

        .add-row-wrapper {
          justify-content: center;
          padding-top: 0;
          width: 100%;
        }

        .actions {
          margin-left: 0;
          width: 100%;
          justify-content: center;
          flex-direction: column;
          align-items: stretch;
        }

        .actions button {
          flex: none;
          width: 100%;
        }

        .layout-mode-control {
          width: 100%;
        }

        .controls {
          padding: 1.5rem;
        }

        .entries-table-wrapper {
          border: none;
          border-radius: 0;
          overflow: visible;
        }

        .entries-table {
          display: block;
          width: 100%;
        }

        .entries-table thead {
          display: none;
        }

        .entries-table tbody {
          display: grid;
          gap: 1.25rem;
        }

        .entries-table tr {
          display: flex;
          flex-direction: column;
          gap: 0.9rem;
          border: 1px solid #e5e7eb;
          border-radius: 16px;
          padding: 1rem 1.1rem;
          box-shadow: 0 20px 40px -18px rgba(15, 23, 42, 0.35);
          background: #ffffff;
        }

        .entries-table td {
          border: none;
          padding: 0;
          background: transparent;
        }

        .entries-table td:first-child,
        .entries-table th:first-child {
          width: auto;
          text-align: left;
          margin-bottom: 0.25rem;
        }

        .entry-index {
          width: 2.5rem;
          height: 2.5rem;
          font-size: 1rem;
          background: #1f2937;
          color: #ffffff;
        }

        .entry-field-label {
          display: block;
        }

        .entries-table input[type='text'],
        .entries-table select {
          padding: 0.65rem 0.75rem;
          font-size: 1rem;
        }

        .a4-tuning-panel {
          padding: 1rem;
        }

        .a4-tuning-input-wrapper {
          flex-direction: column;
          align-items: stretch;
          gap: 0.35rem;
        }

        .a4-tuning-unit {
          align-self: flex-end;
        }
      }

      .controls {
        width: 100%;
        max-width: 1100px;
        background: #ffffff;
        border-radius: 18px;
        box-shadow: 0 25px 50px -12px rgba(15, 23, 42, 0.22);
        padding: 1.75rem;
        display: flex;
        flex-direction: column;
        gap: 1.5rem;
      }

      .controls h2 {
        margin: 0;
        font-size: 1.05rem;
        letter-spacing: 0.08em;
        text-transform: uppercase;
      }

      .control-note {
        margin: 0;
        font-size: 0.85rem;
        line-height: 1.5;
        color: #4b5563;
      }

      .row-controls {
        display: flex;
        align-items: center;
        gap: 1rem;
        flex-wrap: wrap;
      }

      .a4-tuning-toggle {
        display: flex;
        flex-direction: column;
        gap: 0.5rem;
        padding-top: 1rem;
        border-top: 1px solid #e5e7eb;
      }

      .toggle-control {
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        font-weight: 600;
        color: #111827;
        cursor: pointer;
        user-select: none;
      }

      .toggle-control input[type='checkbox'] {
        width: 1.1rem;
        height: 1.1rem;
        border-radius: 0.35rem;
        border: 1px solid #d1d5db;
        cursor: pointer;
      }

      .toggle-control input[type='checkbox']:disabled {
        cursor: not-allowed;
        opacity: 0.6;
      }

      .a4-tuning-note {
        margin: 0;
        color: #4b5563;
      }

      .a4-tuning-panel {
        margin-top: 1.25rem;
        display: flex;
        flex-direction: column;
        gap: 1.25rem;
        padding: 1.25rem;
        border: 1px solid #e5e7eb;
        border-radius: 14px;
        background: #f9fafb;
      }

      .a4-tuning-panel[hidden] {
        display: none !important;
      }

      .a4-tuning-panel.is-disabled {
        opacity: 0.6;
      }

      .a4-tuning-groups {
        display: grid;
        gap: 1.1rem;
      }

      .a4-tuning-group {
        border: none;
        padding: 0;
        margin: 0;
        display: grid;
        gap: 0.85rem;
      }

      .a4-tuning-group legend {
        font-size: 0.85rem;
        letter-spacing: 0.08em;
        text-transform: uppercase;
        color: #6b7280;
        font-weight: 600;
        padding: 0;
      }

      .a4-tuning-field {
        display: flex;
        flex-direction: column;
        gap: 0.45rem;
      }

      .a4-tuning-field-label {
        font-size: 0.9rem;
        font-weight: 400;
        color: #111827;
      }

      .a4-tuning-input-wrapper {
        display: flex;
        align-items: center;
        gap: 0.4rem;
      }

      .a4-tuning-input {
        flex: 1;
        min-width: 0;
        padding: 0.55rem 0.6rem;
        border-radius: 10px;
        border: 1px solid #d1d5db;
        font-size: 0.95rem;
        font-family: inherit;
      }

      .a4-tuning-input:disabled {
        background: #f3f4f6;
        cursor: not-allowed;
      }

      .a4-tuning-unit {
        font-size: 0.85rem;
        color: #6b7280;
        font-weight: 400;
      }

      .a4-tuning-actions {
        display: flex;
        justify-content: flex-end;
      }

      .a4-export-wrapper {
        display: flex;
        flex-direction: column;
        gap: 0.5rem;
      }

      .a4-export-label {
        font-size: 0.85rem;
        letter-spacing: 0.08em;
        text-transform: uppercase;
        color: #6b7280;
        font-weight: 600;
      }

      .a4-export-snippet {
        width: 100%;
        min-height: 8rem;
        padding: 0.75rem;
        border-radius: 12px;
        border: 1px solid #d1d5db;
        font-family: 'SFMono-Regular', 'Menlo', 'Monaco', 'Consolas', 'Liberation Mono', 'Courier New', monospace;
        font-size: 0.85rem;
        background: #ffffff;
        resize: vertical;
      }

      .a4-export-snippet:focus {
        outline: none;
        border-color: #2563eb;
        box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.18);
      }

      .layout-mode-control {
        display: flex;
        flex-direction: column;
        align-items: stretch;
        gap: 0.35rem;
        min-width: 11rem;
      }

      .layout-mode-label {
        font-size: 0.7rem;
        letter-spacing: 0.08em;
        text-transform: uppercase;
        color: #6b7280;
        font-weight: 600;
      }

      .layout-mode-select {
        width: 100%;
        border-radius: 10px;
        border: 1px solid #d1d5db;
        background: #ffffff;
        padding: 0.45rem 0.55rem;
        font-family: inherit;
        font-size: 0.9rem;
        color: #111827;
        transition: border-color 0.2s ease, box-shadow 0.2s ease;
      }

      .layout-mode-select:focus {
        outline: none;
        border-color: #2563eb;
        box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.18);
      }

      .add-row-wrapper {
        display: flex;
        justify-content: flex-start;
        align-items: center;
        gap: 0.75rem;
        padding: 0.85rem 0 0;
      }

      .add-row-button,
      .duplicate-row-button {
        width: 2.6rem;
        height: 2.6rem;
        border-radius: 999px;
        border: none;
        background: #e5e7eb;
        color: #111827;
        font-size: 1.4rem;
        font-weight: 600;
        line-height: 1;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: transform 0.15s ease, box-shadow 0.2s ease, background 0.2s ease;
      }

      .duplicate-row-button {
        background: #dbeafe;
        color: #1e3a8a;
        font-size: 1.15rem;
      }

      .add-row-button:hover:not(:disabled),
      .duplicate-row-button:hover:not(:disabled) {
        transform: translateY(-1px);
        box-shadow: 0 12px 25px -14px rgba(15, 23, 42, 0.45);
      }

      .add-row-button:hover:not(:disabled) {
        background: #d1d5db;
      }

      .duplicate-row-button:hover:not(:disabled) {
        background: #bfdbfe;
      }

      .add-row-button:disabled,
      .duplicate-row-button:disabled {
        opacity: 0.45;
        cursor: not-allowed;
        transform: none;
        box-shadow: none;
      }

      .entries-table-wrapper {
        border: 1px solid #e5e7eb;
        border-radius: 14px;
        overflow: hidden;
      }

      .entries-table {
        width: 100%;
        border-collapse: separate;
        border-spacing: 0;
      }

      .entries-table th,
      .entries-table td {
        border-right: 1px solid #e5e7eb;
        border-bottom: 1px solid #e5e7eb;
        padding: 0.5rem 0.6rem;
        background: #ffffff;
        vertical-align: top;
      }

      .entries-table th:last-child,
      .entries-table td:last-child {
        border-right: none;
      }

      .entries-table tbody tr:last-child td {
        border-bottom: none;
      }

      .entries-table th {
        background: #f3f4f6;
        font-size: 0.75rem;
        letter-spacing: 0.08em;
        text-transform: uppercase;
        color: #4b5563;
        position: sticky;
        top: 0;
        z-index: 1;
      }

      .entries-table td:first-child,
      .entries-table th:first-child {
        text-align: center;
        width: 2.2rem;
        font-weight: 700;
      }

      .entries-table tr[hidden] {
        display: none !important;
      }

      .entry-index {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        width: 1.9rem;
        height: 1.9rem;
        border-radius: 999px;
        background: #f3f4f6;
        color: #111827;
        font-weight: 700;
        font-size: 0.85rem;
        line-height: 1;
      }

      .entry-field {
        display: flex;
        flex-direction: column;
        align-items: stretch;
        gap: 0.45rem;
      }

      .entry-field-label {
        display: none;
        font-size: 0.7rem;
        letter-spacing: 0.08em;
        text-transform: uppercase;
        color: #6b7280;
        font-weight: 600;
      }

      .entries-table input[type='text'],
      .entries-table select {
        width: 100%;
        border-radius: 10px;
        border: 1px solid #d1d5db;
        background: #ffffff;
        padding: 0.45rem 0.55rem;
        font-family: inherit;
        font-size: 0.9rem;
        transition: border-color 0.2s ease, box-shadow 0.2s ease;
      }

      .entries-table input[type='text']:focus,
      .entries-table select:focus {
        outline: none;
        border-color: #2563eb;
        box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.18);
      }

      .actions {
        display: flex;
        flex-wrap: wrap;
        gap: 0.75rem;
        margin-left: auto;
        align-items: center;
        justify-content: flex-end;
      }

      button {
        border: none;
        border-radius: 999px;
        padding: 0.65rem 1.4rem;
        font-weight: 600;
        letter-spacing: 0.05em;
        text-transform: uppercase;
        cursor: pointer;
        font-size: 0.78rem;
        transition: transform 0.15s ease, box-shadow 0.2s ease;
        background: #111827;
        color: #ffffff;
      }

      button.secondary {
        background: #e5e7eb;
        color: #111827;
      }

      button.primary {
        background: #2563eb;
      }

      button:hover {
        transform: translateY(-1px);
        box-shadow: 0 15px 25px -15px rgba(15, 23, 42, 0.45);
      }

      button:disabled {
        opacity: 0.5;
        cursor: not-allowed;
        box-shadow: none;
        transform: none;
      }

      .preview-wrapper {
        display: none;
        justify-content: center;
        align-items: flex-start;
        width: 100%;
        max-width: 1100px;
        margin: 0 auto;
      }

      .preview-wrapper.is-visible {
        display: flex;
      }

      .preview-page {
        position: relative;
        width: var(--page-width);
        min-width: var(--page-width);
        height: var(--page-height);
        background: #ffffff;
        border-radius: 14px;
        padding: var(--page-padding-top) var(--page-padding-right) var(--page-padding-bottom) var(--page-padding-left);
        box-shadow: 0 35px 70px rgba(15, 23, 42, 0.2);
        overflow: hidden;
      }

      .preview-page.is-pdf-export {
        box-shadow: none;
      }

      .preview-page.is-pdf-export::after {
        display: none;
      }

      .preview-page::after {
        content: '';
        position: absolute;
        inset: 0;
        border-radius: inherit;
        pointer-events: none;
        border: 1px solid rgba(15, 23, 42, 0.08);
      }

      .label-grid {
        position: relative;
        width: 100%;
        height: 100%;
        display: grid;
        grid-template-columns: var(--column-template);
        grid-auto-rows: var(--tag-height);
        column-gap: var(--column-gap);
        row-gap: var(--row-gap);
        justify-content: center;
        align-content: start;
      }

      .label {
        width: 100%;
        height: var(--tag-height);
        display: grid;
        grid-template-columns: 3.7cm 1fr;
        background: #ffffff;
        border-radius: 0;
        overflow: hidden;
      }

      body[data-paper-size='a4-single'] .label-grid {
        display: flex;
        align-items: center;
        justify-content: center;
      }

      body[data-paper-size='a4-single'] .label {
        width: var(--tag-width);
        max-width: 100%;
        height: var(--tag-height);
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: flex-start;
        padding: 0;
        background: #ffffff;
        border-radius: 0;
        border: none;
        box-shadow: none;
        overflow: visible;
        gap: 0;
        color: #000000;
      }

      body[data-paper-size='a4-single'] .label-card {
        background: transparent;
        color: inherit;
        padding: 0;
        gap: 0;
        text-align: center;
        align-items: center;
      }

      body[data-paper-size='a4-single'] .label-card-body {
        width: 100%;
        gap: 0;
        align-items: center;
        justify-content: flex-start;
        padding-top: 0.35cm;
      }

      body[data-paper-size='a4-single'] .tag-heading {
        font-family: var(--heading-font);
        font-size: var(--tag-heading-size);
        letter-spacing: var(--a4-heading-letter-spacing);
        text-transform: none;
        font-weight: 800;
        line-height: 1.02;
        margin: 0;
        margin-bottom: var(--a4-heading-margin-bottom);
        color: #000000;
      }

      body[data-paper-size='a4-single'] .price {
        font-family: 'CoopHeadline', 'Barlow Condensed', 'Impact', sans-serif;
        font-size: var(--a4-price-font-size);
        line-height: 0.98;
        letter-spacing: var(--a4-price-letter-spacing);
        font-weight: 800;
        margin: 0;
        margin-top: var(--a4-price-margin-top);
        color: #000000;
      }

      body[data-paper-size='a4-single'] .unit-line {
        font-family: var(--body-font);
        font-size: var(--a4-unit-font-size);
        font-style: normal;
        color: #000000;
        gap: 0.2cm;
        flex-wrap: wrap;
        justify-content: center;
        letter-spacing: var(--a4-unit-letter-spacing);
        margin-top: var(--a4-unit-margin-top);
        margin-bottom: 0;
      }

      body[data-paper-size='a4-single'] .unit-line::before {
        content: 'Equivalent price';
        font-weight: 400;
      }

      body[data-paper-size='a4-single'] .unit-line span {
        font-weight: 400;
        color: inherit;
      }

      body[data-paper-size='a4-single'] .unit-price,
      body[data-paper-size='a4-single'] .unit-separator,
      body[data-paper-size='a4-single'] .unit-text {
        color: inherit;
      }

      body[data-paper-size='a4-single'] .unit-separator {
        text-transform: none;
      }

      body[data-paper-size='a4-single'] .expiry-pill {
        margin-top: var(--a4-end-margin-top);
        background: transparent;
        color: #000000;
        border-radius: 0;
        padding: 0;
        font-size: var(--a4-end-font-size);
        letter-spacing: var(--a4-end-letter-spacing);
        font-style: normal;
        gap: 0.08cm;
        flex-wrap: wrap;
        justify-content: center;
        margin-bottom: 0;
        font-family: 'Avenir Next', 'Avenir Next LT Pro', 'Avenir', 'Montserrat', sans-serif;
      }

      body[data-paper-size='a4-single'] .expiry-label {
        font-weight: 400;
        text-transform: none;
      }

      body[data-paper-size='a4-single'] .expiry-date {
        font-size: inherit;
        letter-spacing: var(--a4-end-date-letter-spacing);
        font-weight: 400;
      }

      body[data-paper-size='a4-single'] .label-blank {
        background: transparent;
        padding: 0;
        width: 100%;
        display: flex;
        align-items: flex-start;
        justify-content: center;
        margin-top: var(--a4-product-margin-top);
      }

      body[data-paper-size='a4-single'] .product-name {
        font-family: var(--body-font);
        font-size: var(--a4-product-font-size);
        letter-spacing: var(--a4-product-letter-spacing);
        color: #000000;
        font-weight: 400;
        margin: 0;
        text-align: center;
        line-height: 1.15;
        transform: translateX(var(--a4-product-translate-x));
      }

      .label.is-placeholder {
        visibility: hidden;
        pointer-events: none;
      }

      .label-card {
        background: var(--tag-bg);
        color: var(--tag-text);
        padding: 0.28cm 0.44cm 0.26cm;
        display: flex;
        flex-direction: column;
        align-items: stretch;
        text-align: center;
        gap: 0.09cm;
        width: 100%;
        height: 100%;
        border-radius: 0;
        justify-content: flex-start;
      }

      .label-card-body {
        display: flex;
        flex-direction: column;
        align-items: stretch;
        justify-content: flex-start;
        gap: 0.09cm;
        flex: 1 1 auto;
      }

      .label-card[data-has-expiry='false'] .label-card-body {
        justify-content: space-evenly;
      }

      .label-card[data-has-expiry='false'] .tag-heading,
      .label-card[data-has-expiry='false'] .price,
      .label-card[data-has-expiry='false'] .unit-line {
        flex: 1 1 auto;
      }

      .label-card[data-has-expiry='false'] .tag-heading,
      .label-card[data-has-expiry='false'] .price {
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .label-card .tag-heading,
      .label-card .price,
      .label-card .unit-line {
        align-self: center;
        text-align: center;
      }

      .label-blank {
        background: #ffffff;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 0.4cm;
      }

      .product-name {
        font-family: 'Montserrat', 'Helvetica Neue', Arial, sans-serif;
        font-weight: 600;
        font-size: calc(0.6cm * var(--product-name-scale));
        color: #000000;
        text-align: center;
        line-height: 1.1;
        word-break: break-word;
        width: 100%;
      }

      .product-name[data-empty='true'] {
        opacity: 0.45;
      }

      .tag-heading {
        font-family: var(--heading-font);
        font-size: var(--tag-heading-size);
        letter-spacing: 0.04em;
        text-transform: none;
        font-weight: 700;
        line-height: 1.3;
        white-space: nowrap;
        margin: 0;
        transform: scaleY(var(--heading-height-scale));
        transform-origin: center;
      }

      .price {
        font-family: var(--display-font);
        font-size: 1.82cm;
        line-height: 0.7;
        font-weight: 400;
        letter-spacing: 0.01em;
        transform: scale(var(--price-scale, 1));
        transform-origin: center;
        white-space: nowrap;
      }

      .unit-line {
        font-size: 0.33cm;
        letter-spacing: 0.06em;
        font-weight: 400;
        color: #ffffff;
        display: flex;
        gap: 0.1cm;
        align-items: baseline;
        justify-content: center;
        font-family: 'Avenir Next', 'Avenir Next LT Pro', 'Avenir', 'Montserrat', sans-serif;
        font-style: italic;
        transform: scaleY(var(--unit-height-scale));
        transform-origin: center;
      }

      .unit-separator {
        text-transform: lowercase;
      }

      .unit-price {
        color: #ffffff;
      }

      .expiry-pill {
        margin-top: auto;
        align-self: center;
        background: #ffffff;
        color: #000000;
        border-radius: 999px;
        padding: 0.12cm 0.36cm;
        font-size: 0.24cm;
        font-weight: 400;
        letter-spacing: 0.06em;
        text-transform: none;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        gap: 0.06cm;
        max-width: 100%;
        white-space: nowrap;
        line-height: 1;
        font-family: 'Avenir Next', 'Avenir Next LT Pro', 'Avenir', 'Montserrat', sans-serif;
        font-style: italic;
        transform: scaleY(var(--expiry-height-scale));
        transform-origin: center;
      }

      .expiry-pill[data-empty='true'] {
        display: none;
      }

      .expiry-pill span {
        line-height: 1;
      }

      .expiry-date {
        font-size: 0.2cm;
        letter-spacing: 0.03em;
        color: #000000;
      }

      .price[data-empty='true'],
      .unit-line[data-empty='true'],
      .unit-price[data-empty='true'],
      .unit-text[data-empty='true'],
      .expiry-pill[data-empty='true'],
      .expiry-date[data-empty='true'] {
        opacity: 0.45;
      }

      @page {
        size: A4;
        margin: 0;
      }

      @media print {
        body {
          background: #ffffff;
        }

        header,
        .controls {
          display: none !important;
        }

        main {
          display: block;
          padding: 0;
        }

        .preview-wrapper {
          display: flex !important;
          margin: 0;
          max-width: none;
          justify-content: flex-start;
        }

        .preview-page {
          box-shadow: none;
          margin: 0;
          width: var(--page-width);
          height: var(--page-height);
        }

        .label-card {
          background: var(--tag-bg) !important;
          color: var(--tag-text) !important;
          -webkit-print-color-adjust: exact;
          print-color-adjust: exact;
        }
      }
    </style>
  </head>
  <body>
    <header>Members Price Tag Generator</header>
    <main>
      <section class="controls" aria-label="Tag controls">
        <div>
          <h2>Tag entries</h2>
          <p class="control-note">
            Enter the price, unit price, unit, and end date for each tag. The layout of every tag matches the provided mock-up.
          </p>
        </div>
        <div class="entries-table-wrapper">
          <table class="entries-table">
            <thead>
              <tr>
                <th>#</th>
                <th>Product name</th>
                <th>Price</th>
                <th>Unit price</th>
                <th>Unit</th>
                <th>End date</th>
                <th>Card colour</th>
              </tr>
            </thead>
            <tbody id="entriesBody"></tbody>
          </table>
        </div>
        <div class="row-controls">
          <div class="add-row-wrapper">
            <button
              type="button"
              class="add-row-button"
              id="addRow"
              aria-label="Add another entry"
              title="Add another entry"
            >
              +
            </button>
            <button
              type="button"
              class="duplicate-row-button"
              id="duplicateRow"
              aria-label="Duplicate last entry"
              title="Duplicate last entry"
            >
              ⧉
            </button>
          </div>
          <div class="actions">
            <div class="layout-mode-control">
              <label class="layout-mode-label" for="paperSize">Paper size</label>
              <select id="paperSize" name="paperSize" class="layout-mode-select">
                <option value="large" selected>Large SEL (2 × 7)</option>
                <option value="normal">Normal SEL (3 × 7)</option>
                <option value="a4-single">A4 Single (1 × 1)</option>
              </select>
            </div>
            <div class="layout-mode-control">
              <label class="layout-mode-label" for="layoutMode">Print layout</label>
              <select id="layoutMode" name="layoutMode" class="layout-mode-select">
                <option value="full-bleed" selected>Full Bleed</option>
                <option value="hp-offset">HP Offset</option>
              </select>
            </div>
            <button type="button" class="secondary" id="clearAll">Clear entries</button>
            <button
              type="button"
              class="secondary"
              id="togglePreview"
              aria-expanded="false"
              aria-controls="previewWrapper"
            >
              Show preview
            </button>
            <button type="button" class="secondary" id="printSheet">Open print preview</button>
            <button type="button" class="primary" id="downloadPdf">Download PDF</button>
          </div>
        </div>
        <div class="a4-tuning-toggle">
          <label class="toggle-control" for="a4TuningToggle">
            <input type="checkbox" id="a4TuningToggle" name="a4TuningToggle" />
            <span>Enable A4 Single fine-tuning controls</span>
          </label>
          <p class="control-note a4-tuning-note">
            Adjust typography for the Member Price A4 layout. The controls are available when the A4 Single paper size is
            selected.
          </p>
        </div>
        <div class="a4-tuning-panel" id="a4TuningPanel" hidden aria-hidden="true">
          <div class="a4-tuning-groups" id="a4TuningForm"></div>
          <div class="a4-tuning-actions">
            <button type="button" class="secondary" id="a4ResetButton">Reset to defaults</button>
          </div>
          <div class="a4-export-wrapper">
            <label class="a4-export-label" for="a4ExportSnippet">Export snippet</label>
            <textarea id="a4ExportSnippet" class="a4-export-snippet" rows="6" readonly></textarea>
          </div>
        </div>
      </section>
      <section class="preview-wrapper" id="previewWrapper" aria-label="Tag preview" aria-hidden="true">
        <div class="preview-page" id="tagSheet">
          <div class="label-grid" id="labelGrid"></div>
        </div>
      </section>
    </main>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    ></script>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    ></script>
    <script>
      (function () {
        const PAPER_SIZES = {
          large: { rows: 7, columns: 2 },
          normal: { rows: 7, columns: 3 },
          'a4-single': { rows: 1, columns: 1 },
        };
        const DEFAULT_PAPER_SIZE = 'large';
        const PAPER_SIZE_KEYS = Object.keys(PAPER_SIZES);
        const TOTAL_LABEL_SLOTS =
          PAPER_SIZE_KEYS.reduce((max, key) => {
            const config = PAPER_SIZES[key];
            if (!config) {
              return max;
            }
            const total = Number(config.rows) * Number(config.columns);
            return Number.isFinite(total) && total > max ? total : max;
          }, 0) || 1;

        const VALID_PAPER_SIZES = new Set(PAPER_SIZE_KEYS);

        const TAG_COLOR_OPTIONS = [
          { value: '#00A1CC', label: 'Teal (#00A1CC)' },
          { value: '#000000', label: 'Black (#000000)' },
        ];
        const DEFAULT_TAG_COLOR = TAG_COLOR_OPTIONS[0].value;

        const LAYOUT_MODES = {
          FULL_BLEED: 'full-bleed',
          HP_OFFSET: 'hp-offset',
        };
        const VALID_LAYOUT_MODES = new Set(Object.values(LAYOUT_MODES));
        const DEFAULT_LAYOUT_MODE = LAYOUT_MODES.FULL_BLEED;

        const MONTH_NAMES = [
          'January',
          'February',
          'March',
          'April',
          'May',
          'June',
          'July',
          'August',
          'September',
          'October',
          'November',
          'December',
        ];

        const placeholders = {
          productName: 'Product name',
          price: '£0.00',
          unitPrice: '£0.00',
          unit: '100g',
          endDate: 'DD Month YYYY',
        };

        const tagData = Array.from({ length: TOTAL_LABEL_SLOTS }, () => ({
          productName: '',
          price: '',
          unitPrice: '',
          unit: '',
          endDate: '',
          tagColor: DEFAULT_TAG_COLOR,
        }));

        let activeRowCount = 0;

        const labelGrid = document.getElementById('labelGrid');
        const labelRefs = [];
        const paperSizeSelect = document.getElementById('paperSize');
        const layoutModeSelect = document.getElementById('layoutMode');
        const previewWrapper = document.getElementById('previewWrapper');
        const previewToggleButton = document.getElementById('togglePreview');
        const hpOffsetOption = layoutModeSelect
          ? layoutModeSelect.querySelector('option[value="hp-offset"]')
          : null;
        const a4TuningToggle = document.getElementById('a4TuningToggle');
        const a4TuningPanel = document.getElementById('a4TuningPanel');
        const a4TuningForm = document.getElementById('a4TuningForm');
        const a4ExportSnippet = document.getElementById('a4ExportSnippet');
        const a4ResetButton = document.getElementById('a4ResetButton');
        const a4TuningInputs = new Map();
        const a4TuningState = {};
        const A4_TUNING_INACTIVE_MESSAGE =
          'Enable fine-tuning while "A4 Single" is selected to generate an export snippet.';

        const A4_TUNING_FIELDS = [
          {
            id: 'a4HeadingFontSize',
            group: 'Member price header',
            label: 'Font size (cm)',
            varName: '--a4-heading-font-size',
            unit: 'cm',
            default: 3.175,
            min: 0,
            max: 15,
            step: 0.001,
            decimals: 3,
          },
          {
            id: 'a4HeadingLetterSpacing',
            group: 'Member price header',
            label: 'Letter spacing (em)',
            varName: '--a4-heading-letter-spacing',
            unit: 'em',
            default: 0,
            min: -1,
            max: 1,
            step: 0.001,
            decimals: 3,
          },
          {
            id: 'a4HeadingMarginBottom',
            group: 'Member price header',
            label: 'Spacing below (cm)',
            varName: '--a4-heading-margin-bottom',
            unit: 'cm',
            default: 2.42,
            min: -5,
            max: 15,
            step: 0.01,
            decimals: 3,
          },
          {
            id: 'a4PriceFontSize',
            group: 'Price',
            label: 'Font size (cm)',
            varName: '--a4-price-font-size',
            unit: 'cm',
            default: 5.161,
            min: 0,
            max: 25,
            step: 0.0005,
            decimals: 4,
          },
          {
            id: 'a4PriceLetterSpacing',
            group: 'Price',
            label: 'Letter spacing (em)',
            varName: '--a4-price-letter-spacing',
            unit: 'em',
            default: -0.002,
            min: -0.5,
            max: 0.5,
            step: 0.001,
            decimals: 3,
          },
          {
            id: 'a4PriceMarginTop',
            group: 'Price',
            label: 'Margin top (cm)',
            varName: '--a4-price-margin-top',
            unit: 'cm',
            default: 0,
            min: -5,
            max: 10,
            step: 0.01,
            decimals: 3,
          },
          {
            id: 'a4UnitFontSize',
            group: 'Equivalent price',
            label: 'Font size (cm)',
            varName: '--a4-unit-font-size',
            unit: 'cm',
            default: 0.851,
            min: 0,
            max: 5,
            step: 0.001,
            decimals: 3,
          },
          {
            id: 'a4UnitLetterSpacing',
            group: 'Equivalent price',
            label: 'Letter spacing (em)',
            varName: '--a4-unit-letter-spacing',
            unit: 'em',
            default: 0.01,
            min: -0.5,
            max: 0.5,
            step: 0.001,
            decimals: 3,
          },
          {
            id: 'a4UnitMarginTop',
            group: 'Equivalent price',
            label: 'Margin top (cm)',
            varName: '--a4-unit-margin-top',
            unit: 'cm',
            default: 2.32,
            min: -5,
            max: 15,
            step: 0.01,
            decimals: 3,
          },
          {
            id: 'a4EndFontSize',
            group: 'End date',
            label: 'Font size (cm)',
            varName: '--a4-end-font-size',
            unit: 'cm',
            default: 0.462,
            min: 0,
            max: 3,
            step: 0.001,
            decimals: 3,
          },
          {
            id: 'a4EndLetterSpacing',
            group: 'End date',
            label: 'Letter spacing (em)',
            varName: '--a4-end-letter-spacing',
            unit: 'em',
            default: 0.01,
            min: -0.5,
            max: 0.5,
            step: 0.001,
            decimals: 3,
          },
          {
            id: 'a4EndMarginTop',
            group: 'End date',
            label: 'Margin top (cm)',
            varName: '--a4-end-margin-top',
            unit: 'cm',
            default: 0.92,
            min: -5,
            max: 15,
            step: 0.01,
            decimals: 3,
          },
          {
            id: 'a4EndDateLetterSpacing',
            group: 'End date',
            label: 'Date letter spacing (em)',
            varName: '--a4-end-date-letter-spacing',
            unit: 'em',
            default: 0.02,
            min: -0.5,
            max: 0.5,
            step: 0.001,
            decimals: 3,
          },
          {
            id: 'a4ProductFontSize',
            group: 'Product description',
            label: 'Font size (cm)',
            varName: '--a4-product-font-size',
            unit: 'cm',
            default: 1.168,
            min: 0,
            max: 5,
            step: 0.001,
            decimals: 3,
          },
          {
            id: 'a4ProductLetterSpacing',
            group: 'Product description',
            label: 'Letter spacing (em)',
            varName: '--a4-product-letter-spacing',
            unit: 'em',
            default: 0.012,
            min: -0.5,
            max: 0.5,
            step: 0.001,
            decimals: 3,
          },
          {
            id: 'a4ProductMarginTop',
            group: 'Product description',
            label: 'Margin top (cm)',
            varName: '--a4-product-margin-top',
            unit: 'cm',
            default: 2.64,
            min: -5,
            max: 20,
            step: 0.01,
            decimals: 3,
          },
          {
            id: 'a4ProductTranslateX',
            group: 'Product description',
            label: 'Horizontal offset (cm)',
            varName: '--a4-product-translate-x',
            unit: 'cm',
            default: -2,
            min: -10,
            max: 10,
            step: 0.01,
            decimals: 2,
          },
        ];
        let previewVisible = false;
        let currentLayoutMode = null;
        let currentPaperSize = DEFAULT_PAPER_SIZE;

        const clamp = (value, min, max) => Math.min(Math.max(value, min), max);
        const PRICE_DOUBLE_DIGIT_THRESHOLD = 9.99;
        const PRICE_TRIPLE_DIGIT_THRESHOLD = 99.99;
        const PRICE_DOUBLE_DIGIT_SCALE = 0.8;
        const PRICE_TRIPLE_DIGIT_SCALE = 0.67;

        function normalizeA4FieldValue(field, rawValue) {
          if (!field) {
            return null;
          }

          if (rawValue === null || rawValue === undefined || rawValue === '') {
            if (field.default !== undefined) {
              return normalizeA4FieldValue(field, field.default);
            }
            return null;
          }

          const numeric = Number.parseFloat(rawValue);
          if (!Number.isFinite(numeric)) {
            if (field.default !== undefined) {
              return normalizeA4FieldValue(field, field.default);
            }
            return null;
          }

          let clamped = numeric;
          if (typeof field.min === 'number' && clamped < field.min) {
            clamped = field.min;
          }
          if (typeof field.max === 'number' && clamped > field.max) {
            clamped = field.max;
          }

          const decimals = typeof field.decimals === 'number' ? field.decimals : 3;
          const displayValue = Number(clamped.toFixed(decimals)).toString();
          return {
            displayValue,
            cssValue: `${displayValue}${field.unit}`,
          };
        }

        function applyA4Value(field, rawValue, updateInput = true) {
          const normalized = normalizeA4FieldValue(field, rawValue);
          if (!normalized) {
            return null;
          }

          a4TuningState[field.varName] = normalized.cssValue;

          if (document.body) {
            document.body.style.setProperty(field.varName, normalized.cssValue);
          }

          if (updateInput) {
            const input = a4TuningInputs.get(field.varName);
            if (input && input.value !== normalized.displayValue) {
              input.value = normalized.displayValue;
            }
          }

          return normalized.cssValue;
        }

        function updateA4ExportSnippet() {
          if (!a4ExportSnippet) {
            return;
          }

          const entries = Object.entries(a4TuningState)
            .filter(([, value]) => typeof value === 'string' && value)
            .sort(([a], [b]) => a.localeCompare(b));

          if (!entries.length) {
            a4ExportSnippet.value = A4_TUNING_INACTIVE_MESSAGE;
            return;
          }

          const snippetObject = entries.reduce((acc, [key, value]) => {
            acc[key] = value;
            return acc;
          }, {});
          a4ExportSnippet.value = JSON.stringify(snippetObject, null, 2);
        }

        function handleA4Input(field, rawValue) {
          const cssValue = applyA4Value(field, rawValue);
          if (!cssValue) {
            return;
          }

          updateA4ExportSnippet();

          if (document.body?.dataset?.paperSize === 'a4-single') {
            updateAllLabels();
          }
        }

        function resetA4TuningToDefaults() {
          A4_TUNING_FIELDS.forEach((field) => {
            applyA4Value(field, field.default);
          });

          updateA4ExportSnippet();

          if (document.body?.dataset?.paperSize === 'a4-single') {
            updateAllLabels();
          }
        }

        function syncA4InputsDisabledState(disabled) {
          a4TuningInputs.forEach((input) => {
            input.disabled = disabled;
          });

          if (a4ResetButton) {
            a4ResetButton.disabled = disabled;
          }
        }

        function syncA4TuningAvailability() {
          const isA4 = currentPaperSize === 'a4-single';

          if (a4TuningToggle) {
            a4TuningToggle.disabled = !isA4;
            a4TuningToggle.setAttribute('aria-disabled', !isA4 ? 'true' : 'false');
            if (!isA4 && a4TuningToggle.checked) {
              a4TuningToggle.checked = false;
            }
          }

          const isActive = isA4 && Boolean(a4TuningToggle && a4TuningToggle.checked);

          if (a4TuningPanel) {
            a4TuningPanel.hidden = !isActive;
            a4TuningPanel.setAttribute('aria-hidden', isActive ? 'false' : 'true');
            a4TuningPanel.classList.toggle('is-disabled', !isA4);
          }

          syncA4InputsDisabledState(!isActive);

          if (a4ExportSnippet) {
            if (isActive) {
              updateA4ExportSnippet();
            } else {
              a4ExportSnippet.value = A4_TUNING_INACTIVE_MESSAGE;
            }
          }
        }

        function buildA4TuningControls() {
          if (!a4TuningForm) {
            if (a4ExportSnippet) {
              a4ExportSnippet.value = A4_TUNING_INACTIVE_MESSAGE;
            }
            return;
          }

          const groups = new Map();

          A4_TUNING_FIELDS.forEach((field) => {
            let fieldset = groups.get(field.group);
            if (!fieldset) {
              fieldset = document.createElement('fieldset');
              fieldset.className = 'a4-tuning-group';
              const legend = document.createElement('legend');
              legend.textContent = field.group;
              fieldset.appendChild(legend);
              a4TuningForm.appendChild(fieldset);
              groups.set(field.group, fieldset);
            }

            const wrapper = document.createElement('label');
            wrapper.className = 'a4-tuning-field';
            wrapper.htmlFor = field.id;

            const labelEl = document.createElement('span');
            labelEl.className = 'a4-tuning-field-label';
            labelEl.textContent = field.label;
            wrapper.appendChild(labelEl);

            const inputWrapper = document.createElement('div');
            inputWrapper.className = 'a4-tuning-input-wrapper';

            const input = document.createElement('input');
            input.type = 'number';
            input.className = 'a4-tuning-input';
            input.id = field.id;
            input.name = field.id;
            input.inputMode = 'decimal';

            if (typeof field.step === 'number') {
              input.step = field.step.toString();
            }
            if (typeof field.min === 'number') {
              input.min = field.min.toString();
            }
            if (typeof field.max === 'number') {
              input.max = field.max.toString();
            }

            const normalizedDefault = normalizeA4FieldValue(field, field.default);
            if (normalizedDefault) {
              input.value = normalizedDefault.displayValue;
              a4TuningState[field.varName] = normalizedDefault.cssValue;
              if (document.body) {
                document.body.style.setProperty(field.varName, normalizedDefault.cssValue);
              }
            }

            inputWrapper.appendChild(input);

            const unitEl = document.createElement('span');
            unitEl.className = 'a4-tuning-unit';
            unitEl.textContent = field.unit;
            inputWrapper.appendChild(unitEl);

            wrapper.appendChild(inputWrapper);
            fieldset.appendChild(wrapper);

            a4TuningInputs.set(field.varName, input);

            const handleChange = (event) => {
              handleA4Input(field, event.currentTarget.value);
            };

            input.addEventListener('input', handleChange);
            input.addEventListener('change', handleChange);
          });

          updateA4ExportSnippet();
        }

        buildA4TuningControls();
        syncA4TuningAvailability();




        function normalizePaperSize(value) {
          if (typeof value !== 'string') {
            return DEFAULT_PAPER_SIZE;
          }

          const normalized = value.trim().toLowerCase();
          return VALID_PAPER_SIZES.has(normalized) ? normalized : DEFAULT_PAPER_SIZE;
        }

        function getPaperSizeConfig(sizeKey) {
          const normalized = normalizePaperSize(sizeKey);
          return PAPER_SIZES[normalized] || PAPER_SIZES[DEFAULT_PAPER_SIZE];
        }

        function getActiveLayoutMode() {
          return currentLayoutMode || DEFAULT_LAYOUT_MODE;
        }

        function getBaseColumnCount(config) {
          const rawColumns = Number(config?.columns);
          return Number.isFinite(rawColumns) && rawColumns > 0 ? rawColumns : 1;
        }

        function getPlaceholderColumnCount(layoutMode) {
          return layoutMode === LAYOUT_MODES.HP_OFFSET ? 1 : 0;
        }

        function getEffectiveColumnCount(config, layoutMode) {
          const baseColumns = getBaseColumnCount(config);
          const placeholderColumns = getPlaceholderColumnCount(layoutMode);
          const usableColumns = baseColumns - placeholderColumns;
          return Math.max(1, usableColumns);
        }

        function getMaxSlotCountForPaper(sizeKey) {
          const config = getPaperSizeConfig(sizeKey);
          const rowsValue = Number(config?.rows);
          const rows = Number.isFinite(rowsValue) && rowsValue > 0 ? rowsValue : 1;
          const baseColumns = getBaseColumnCount(config);
          const total = rows * baseColumns;
          return Number.isFinite(total) && total > 0 ? total : 1;
        }

        function getMaxTagCountForPaper(sizeKey, layoutModeOverride) {
          const config = getPaperSizeConfig(sizeKey);
          const rowsValue = Number(config?.rows);
          const rows = Number.isFinite(rowsValue) && rowsValue > 0 ? rowsValue : 1;
          const layoutModeToUse =
            typeof layoutModeOverride === 'string'
              ? normalizeLayoutMode(layoutModeOverride)
              : getActiveLayoutMode();
          const columns = getEffectiveColumnCount(config, layoutModeToUse);
          const total = rows * columns;
          return Number.isFinite(total) && total > 0 ? total : 1;
        }

        function getCurrentMaxTagCount() {
          return getMaxTagCountForPaper(currentPaperSize);
        }

        function getCurrentMaxSlotCount() {
          return getMaxSlotCountForPaper(currentPaperSize);
        }

        function getLabelDataIndex(labelIndex, layoutModeOverride) {
          const config = getPaperSizeConfig(currentPaperSize);
          const baseColumns = getBaseColumnCount(config);

          if (!Number.isFinite(baseColumns) || baseColumns <= 0) {
            return labelIndex;
          }

          const layoutModeToUse =
            typeof layoutModeOverride === 'string'
              ? normalizeLayoutMode(layoutModeOverride)
              : getActiveLayoutMode();
          const placeholderColumns = getPlaceholderColumnCount(layoutModeToUse);

          if (!placeholderColumns) {
            return labelIndex;
          }

          if (placeholderColumns >= baseColumns) {
            return null;
          }

          const columnIndex = labelIndex % baseColumns;
          if (columnIndex < placeholderColumns) {
            return null;
          }

          const rowIndex = Math.floor(labelIndex / baseColumns);
          const usableColumns = baseColumns - placeholderColumns;
          return rowIndex * usableColumns + (columnIndex - placeholderColumns);
        }

        function createLabel(index) {
          const label = document.createElement('div');
          label.className = 'label';
          label.innerHTML = `
            <div class="label-card" data-has-expiry="false">
              <div class="label-card-body">
                <div class="tag-heading">Member Price</div>
                <div class="price" data-role="price">${placeholders.price}</div>
                <div class="unit-line" data-role="unit-line">
                  <span class="unit-price" data-role="unit-price">${placeholders.unitPrice}</span>
                  <span class="unit-separator">per</span>
                  <span class="unit-text" data-role="unit">${placeholders.unit}</span>
                </div>
              </div>
              <div class="expiry-pill" data-role="expiry" data-empty="true" aria-hidden="true">
                <span class="expiry-label" data-role="expiry-label">Ends</span>
                <span class="expiry-date" data-role="end-date" data-empty="true">${placeholders.endDate}</span>
              </div>
            </div>
            <div class="label-blank">
              <div class="product-name" data-role="product-name">${placeholders.productName}</div>
            </div>
          `;
          const cardEl = label.querySelector('.label-card');
          const productNameEl = label.querySelector('[data-role="product-name"]');
          const priceEl = label.querySelector('[data-role="price"]');
          const unitPriceEl = label.querySelector('[data-role="unit-price"]');
          const unitEl = label.querySelector('[data-role="unit"]');
          const unitLineEl = label.querySelector('[data-role="unit-line"]');
          const expiryEl = label.querySelector('[data-role="end-date"]');
          const expiryPill = label.querySelector('[data-role="expiry"]');
          const expiryLabelEl = label.querySelector('[data-role="expiry-label"]');
          labelGrid.appendChild(label);
          labelRefs[index] = {
            label,
            cardEl,
            productNameEl,
            priceEl,
            unitPriceEl,
            unitEl,
            unitLineEl,
            expiryEl,
            expiryPill,
            expiryLabelEl,
          };
        }

        for (let i = 0; i < TOTAL_LABEL_SLOTS; i += 1) {
          createLabel(i);
        }

          function formatDate(value) {
            if (!value) return '';
            const trimmed = value.trim();
            if (!trimmed) return '';

            let day;
            let month;
            let year;

            if (/^\d{4}-\d{2}-\d{2}$/.test(trimmed)) {
              [year, month, day] = trimmed.split('-');
            } else if (/^\d{2}\/\d{2}\/\d{4}$/.test(trimmed)) {
              [day, month, year] = trimmed.split('/');
            } else {
              const parsed = new Date(trimmed);
              if (Number.isNaN(parsed.getTime())) {
                return trimmed;
              }
              day = String(parsed.getDate());
              month = String(parsed.getMonth() + 1).padStart(2, '0');
              year = String(parsed.getFullYear());
            }

            const monthIndex = Number.parseInt(month, 10) - 1;
            if (monthIndex < 0 || monthIndex >= MONTH_NAMES.length) {
              return trimmed;
            }

            const dayNumber = Number.parseInt(day, 10);
            if (!Number.isFinite(dayNumber)) {
              return trimmed;
            }

            const monthName = MONTH_NAMES[monthIndex];
            return `${dayNumber} ${monthName} ${year}`;
          }

        function setText(element, value, placeholder) {
          const text = (value || '').trim();
          if (text) {
            element.textContent = text;
            element.dataset.empty = 'false';
          } else {
            element.textContent = placeholder;
            element.dataset.empty = 'true';
          }
        }

        function parsePriceValue(text) {
          if (!text) return null;
          const normalized = text.replace(/[^0-9.,-]/g, '').replace(/,/g, '');
          if (!normalized) return null;
          const value = parseFloat(normalized);
          if (!Number.isFinite(value)) {
            return null;
          }
          return Math.abs(value);
        }

        function getBasePriceScale(value) {
          if (!Number.isFinite(value)) {
            return 1;
          }
          if (value > PRICE_TRIPLE_DIGIT_THRESHOLD) {
            return PRICE_TRIPLE_DIGIT_SCALE;
          }
          if (value > PRICE_DOUBLE_DIGIT_THRESHOLD) {
            return PRICE_DOUBLE_DIGIT_SCALE;
          }
          return 1;
        }

        function applyPriceScaling(priceEl) {
          if (!priceEl) return;

          priceEl.style.setProperty('--price-scale', '1');

          const priceValue = parsePriceValue(priceEl.textContent || '');
          let finalScale = getBasePriceScale(priceValue);

          if (priceEl.offsetParent !== null) {
            const availableWidth = priceEl.clientWidth;
            const availableHeight = priceEl.clientHeight;
            const requiredWidth = priceEl.scrollWidth;
            const requiredHeight = priceEl.scrollHeight;

            if (availableWidth && availableHeight && requiredWidth && requiredHeight) {
              const widthRatio = availableWidth / requiredWidth;
              const heightRatio = availableHeight / requiredHeight;
              const autoScale = Math.min(1, widthRatio, heightRatio);
              finalScale = Math.min(finalScale, autoScale);
            }
          }

          priceEl.style.setProperty('--price-scale', finalScale < 1 ? finalScale.toFixed(3) : '1');
        }

        function updateLabel(index) {
          const refs = labelRefs[index];
          if (!refs) return;

          const maxForCurrent = getCurrentMaxTagCount();
          const maxSlotCount = getCurrentMaxSlotCount();
          const dataIndex = getLabelDataIndex(index);
          const isPlaceholder = dataIndex === null;
          const isWithinGrid = index < maxSlotCount;
          const activeDisplay = document.body?.dataset?.paperSize === 'a4-single' ? 'flex' : 'grid';

          refs.label.classList.toggle('is-placeholder', Boolean(isPlaceholder));

          if (!isWithinGrid) {
            refs.label.style.display = 'none';
            refs.label.setAttribute('aria-hidden', 'true');
            return;
          }

          if (isPlaceholder) {
            refs.label.style.display = activeDisplay;
            refs.label.setAttribute('aria-hidden', 'true');
            return;
          }

          const isActiveSlot = dataIndex < activeRowCount && dataIndex < maxForCurrent;
          if (!isActiveSlot) {
            refs.label.style.display = 'none';
            refs.label.setAttribute('aria-hidden', 'true');
            return;
          }

          refs.label.style.display = activeDisplay;
          refs.label.setAttribute('aria-hidden', 'false');

          if (refs.expiryLabelEl) {
            const paperSize = document.body?.dataset?.paperSize || '';
            const expiryLabelText = paperSize === 'a4-single' ? 'Offer end date' : 'Ends';
            if (refs.expiryLabelEl.textContent !== expiryLabelText) {
              refs.expiryLabelEl.textContent = expiryLabelText;
            }
          }

          const data = tagData[dataIndex] || {};
          setText(refs.productNameEl, data.productName, placeholders.productName);
          setText(refs.priceEl, data.price, placeholders.price);
          setText(refs.unitPriceEl, data.unitPrice, placeholders.unitPrice);
          setText(refs.unitEl, data.unit, placeholders.unit);
          const formattedDate = formatDate(data.endDate);
          setText(refs.expiryEl, formattedDate, placeholders.endDate);
          const expiryIsEmpty = refs.expiryEl.dataset.empty === 'true';
          refs.expiryPill.dataset.empty = expiryIsEmpty ? 'true' : 'false';
          refs.expiryPill.hidden = expiryIsEmpty;
          refs.expiryPill.setAttribute('aria-hidden', expiryIsEmpty ? 'true' : 'false');
          if (refs.cardEl) {
            refs.cardEl.dataset.hasExpiry = expiryIsEmpty ? 'false' : 'true';
          }
          const hasUnitDetails = Boolean((data.unitPrice || '').trim() || (data.unit || '').trim());
          refs.unitLineEl.dataset.empty = hasUnitDetails ? 'false' : 'true';

          const selectedColor = (data.tagColor || '').trim().toLowerCase();
          const matchingColor =
            TAG_COLOR_OPTIONS.find((option) => option.value.toLowerCase() === selectedColor)?.value ||
            DEFAULT_TAG_COLOR;

          refs.label.style.setProperty('--tag-bg', matchingColor);
          if (refs.cardEl) {
            refs.cardEl.style.setProperty('--tag-bg', matchingColor);
            if (document.body?.dataset?.paperSize === 'a4-single') {
              refs.cardEl.style.removeProperty('background-color');
            } else {
              refs.cardEl.style.backgroundColor = matchingColor;
            }
          }

          applyPriceScaling(refs.priceEl);
        }

        function updateAllLabels() {
          for (let i = 0; i < TOTAL_LABEL_SLOTS; i += 1) {
            updateLabel(i);
          }
        }

        function applyPaperSize(nextSize) {
          const normalized = normalizePaperSize(nextSize);

          currentPaperSize = normalized;

          if (hpOffsetOption) {
            hpOffsetOption.disabled = normalized === 'a4-single';
          }

          if (normalized === 'a4-single' && getActiveLayoutMode() === LAYOUT_MODES.HP_OFFSET) {
            applyLayoutMode(LAYOUT_MODES.FULL_BLEED);
          }

          if (document.body && document.body.dataset.paperSize !== normalized) {
            document.body.dataset.paperSize = normalized;
          }

          if (paperSizeSelect && paperSizeSelect.value !== normalized) {
            paperSizeSelect.value = normalized;
          }

          syncA4TuningAvailability();

          const maxForCurrent = getCurrentMaxTagCount();
          const desiredCount = activeRowCount > 0 ? activeRowCount : 1;
          setActiveRowCount(Math.min(desiredCount, maxForCurrent));
        }

        function normalizeLayoutMode(value) {
          if (typeof value !== 'string') {
            return DEFAULT_LAYOUT_MODE;
          }

          const normalized = value.trim().toLowerCase();
          return VALID_LAYOUT_MODES.has(normalized) ? normalized : DEFAULT_LAYOUT_MODE;
        }

        function applyLayoutMode(nextMode) {
          let normalized = normalizeLayoutMode(nextMode);

          if (currentPaperSize === 'a4-single' && normalized === LAYOUT_MODES.HP_OFFSET) {
            normalized = LAYOUT_MODES.FULL_BLEED;
          }

          if (document.body && document.body.dataset.layoutMode !== normalized) {
            document.body.dataset.layoutMode = normalized;
          }

          if (layoutModeSelect && layoutModeSelect.value !== normalized) {
            layoutModeSelect.value = normalized;
          }

          if (currentLayoutMode !== normalized) {
            currentLayoutMode = normalized;
            const maxForCurrent = getCurrentMaxTagCount();
            if (activeRowCount > maxForCurrent) {
              setActiveRowCount(maxForCurrent);
            } else {
              updateAllLabels();
            }
          }
        }

        function setPreviewVisibility(visible) {
          previewVisible = visible;

          if (previewWrapper) {
            previewWrapper.classList.toggle('is-visible', visible);
            previewWrapper.setAttribute('aria-hidden', visible ? 'false' : 'true');
          }

          if (previewToggleButton) {
            previewToggleButton.textContent = visible ? 'Hide preview' : 'Show preview';
            previewToggleButton.setAttribute('aria-expanded', visible ? 'true' : 'false');
          }

          if (visible) {
            updateAllLabels();
          }
        }

        if (a4ResetButton) {
          a4ResetButton.addEventListener('click', () => {
            resetA4TuningToDefaults();
          });
        }

        if (a4TuningToggle) {
          a4TuningToggle.addEventListener('change', () => {
            syncA4TuningAvailability();
            if (document.body?.dataset?.paperSize === 'a4-single') {
              updateAllLabels();
            }
          });
        }

        if (previewToggleButton) {
          previewToggleButton.addEventListener('click', () => {
            setPreviewVisibility(!previewVisible);
          });
        }

        if (paperSizeSelect) {
          paperSizeSelect.addEventListener('change', (event) => {
            applyPaperSize(event.currentTarget.value);
          });
        }

        if (layoutModeSelect) {
          layoutModeSelect.addEventListener('change', (event) => {
            applyLayoutMode(event.currentTarget.value);
          });
        }

        const entriesBody = document.getElementById('entriesBody');
        const fields = [
          {
            key: 'productName',
            label: 'Product name',
            placeholder: 'Product name',
            inputMode: 'text',
            autoCapitalize: 'words',
            enterKeyHint: 'next',
          },
          {
            key: 'price',
            label: 'Price',
            placeholder: '£4.75',
            inputMode: 'text',
            autoCapitalize: 'none',
            enterKeyHint: 'next',
          },
          {
            key: 'unitPrice',
            label: 'Unit price',
            placeholder: '£2.38',
            inputMode: 'text',
            autoCapitalize: 'none',
            enterKeyHint: 'next',
          },
          {
            key: 'unit',
            label: 'Unit',
            placeholder: '100g',
            inputMode: 'text',
            autoCapitalize: 'none',
            enterKeyHint: 'next',
          },
          {
            key: 'endDate',
            label: 'End date',
            placeholder: '14/08/2025',
            inputMode: 'text',
            autoCapitalize: 'none',
            enterKeyHint: 'done',
          },
        ];

        const entryRows = [];

        tagData.forEach((_, index) => {
          const row = document.createElement('tr');
          row.dataset.index = index;

          const indexCell = document.createElement('td');
          indexCell.setAttribute('aria-label', `Tag ${index + 1}`);
          const indexBadge = document.createElement('span');
          indexBadge.className = 'entry-index';
          indexBadge.textContent = index + 1;
          indexCell.appendChild(indexBadge);
          row.appendChild(indexCell);

          fields.forEach((field) => {
            const cell = document.createElement('td');
            const fieldWrapper = document.createElement('label');
            fieldWrapper.className = 'entry-field';
            fieldWrapper.dataset.field = field.key;

            const fieldLabel = document.createElement('span');
            fieldLabel.className = 'entry-field-label';
            fieldLabel.textContent = field.label;
            fieldWrapper.appendChild(fieldLabel);

            const input = document.createElement('input');
            input.type = 'text';
            input.className = 'entry-input';
            input.dataset.index = index;
            input.dataset.field = field.key;
            input.placeholder = field.placeholder;
            input.autocomplete = 'off';
            input.spellcheck = false;
            input.id = `entry-${field.key}-${index}`;
            input.name = `entry-${field.key}-${index}`;

            if (field.inputMode) {
              input.inputMode = field.inputMode;
            }

            if (field.autoCapitalize) {
              input.autocapitalize = field.autoCapitalize;
            }

            if (field.enterKeyHint) {
              input.enterKeyHint = field.enterKeyHint;
            }

            fieldWrapper.htmlFor = input.id;
            fieldWrapper.appendChild(input);
            cell.appendChild(fieldWrapper);
            row.appendChild(cell);
          });

          const colourCell = document.createElement('td');
          const colourWrapper = document.createElement('label');
          colourWrapper.className = 'entry-field';
          colourWrapper.dataset.field = 'tagColor';

          const colourLabel = document.createElement('span');
          colourLabel.className = 'entry-field-label';
          colourLabel.textContent = 'Card colour';
          colourWrapper.appendChild(colourLabel);

          const colourSelect = document.createElement('select');
          colourSelect.className = 'entry-input';
          colourSelect.dataset.index = index;
          colourSelect.dataset.field = 'tagColor';
          colourSelect.id = `entry-tagColor-${index}`;
          colourSelect.name = `entry-tagColor-${index}`;

          TAG_COLOR_OPTIONS.forEach((option) => {
            const optionEl = document.createElement('option');
            optionEl.value = option.value;
            optionEl.textContent = option.label;
            colourSelect.appendChild(optionEl);
          });

          colourWrapper.htmlFor = colourSelect.id;
          colourWrapper.appendChild(colourSelect);
          colourCell.appendChild(colourWrapper);
          row.appendChild(colourCell);

          row.hidden = true;
          entriesBody.appendChild(row);
          entryRows.push(row);
        });

        const entryInputs = Array.from(document.querySelectorAll('.entry-input'));

        function syncInputsFromData() {
          entryInputs.forEach((input) => {
            const index = Number(input.dataset.index);
            const field = input.dataset.field;
            if (field === 'tagColor') {
              const storedValue = tagData[index][field] || DEFAULT_TAG_COLOR;
              input.value = storedValue;
              if (!tagData[index][field]) {
                tagData[index][field] = storedValue;
              }
            } else {
              input.value = tagData[index][field] || '';
            }
          });
        }

        entryInputs.forEach((input) => {
          const handleInput = (event) => {
            const target = event.currentTarget;
            const index = Number(target.dataset.index);
            const field = target.dataset.field;
            tagData[index][field] = target.value;
            updateLabel(index);
          };
          input.addEventListener('input', handleInput);
          input.addEventListener('change', handleInput);
        });

        const addRowButton = document.getElementById('addRow');
        const duplicateRowButton = document.getElementById('duplicateRow');

        function setActiveRowCount(newCount) {
          const maxForCurrent = getCurrentMaxTagCount();
          const clamped = clamp(newCount, 1, maxForCurrent);
          activeRowCount = clamped;

          entryRows.forEach((row, index) => {
            row.hidden = index >= activeRowCount || index >= maxForCurrent;
          });

          if (addRowButton) {
            addRowButton.disabled = activeRowCount >= maxForCurrent;
          }

          if (duplicateRowButton) {
            duplicateRowButton.disabled = activeRowCount >= maxForCurrent;
          }

          updateAllLabels();
        }

        if (addRowButton) {
          addRowButton.addEventListener('click', () => {
            if (activeRowCount < getCurrentMaxTagCount()) {
              setActiveRowCount(activeRowCount + 1);
              syncInputsFromData();
            }
          });
        }

        if (duplicateRowButton) {
          duplicateRowButton.addEventListener('click', () => {
            if (activeRowCount >= getCurrentMaxTagCount()) {
              return;
            }

            const sourceIndex = Math.max(activeRowCount - 1, 0);
            const base = { ...tagData[sourceIndex] };
            tagData[activeRowCount] = { ...base };
            setActiveRowCount(activeRowCount + 1);
            syncInputsFromData();
          });
        }

        document.getElementById('clearAll').addEventListener('click', () => {
          tagData.forEach((item) => {
            item.productName = '';
            item.price = '';
            item.unitPrice = '';
            item.unit = '';
            item.endDate = '';
            item.tagColor = DEFAULT_TAG_COLOR;
          });
          syncInputsFromData();
          setActiveRowCount(1);
        });

        setPreviewVisibility(false);
        applyPaperSize(paperSizeSelect ? paperSizeSelect.value : DEFAULT_PAPER_SIZE);
        syncInputsFromData();
        applyLayoutMode(layoutModeSelect ? layoutModeSelect.value : DEFAULT_LAYOUT_MODE);

        if (document.fonts && document.fonts.ready) {
          document.fonts.ready.then(() => {
            updateAllLabels();
          });
        } else {
          updateAllLabels();
        }

        window.addEventListener('resize', () => {
          updateAllLabels();
        });

        const PDF_EXPORT_FILENAME = 'members-price-tags.pdf';
        const PDF_PAGE_SETTINGS = { unit: 'cm', format: 'a4', orientation: 'portrait' };
        const HTML2CANVAS_EXPORT_OPTIONS = {
          backgroundColor: '#ffffff',
          scale: 2,
          useCORS: true,
          scrollX: 0,
          scrollY: 0,
          logging: false,
        };

        function getJsPdfConstructor() {
          if (window.jspdf && typeof window.jspdf.jsPDF === 'function') {
            return window.jspdf.jsPDF;
          }
          if (typeof window.jsPDF === 'function') {
            return window.jsPDF;
          }
          return null;
        }

        const downloadButton = document.getElementById('downloadPdf');

        if (downloadButton) {
          downloadButton.addEventListener('click', async () => {
            const sheet = document.getElementById('tagSheet');
            if (!sheet) {
              return;
            }

            const html2canvasFn = window.html2canvas;
            const JsPdfConstructor = getJsPdfConstructor();

            if (typeof html2canvasFn !== 'function' || typeof JsPdfConstructor !== 'function') {
              alert('Unable to generate the PDF right now. Please try using the print option instead.');
              return;
            }

            if (document.fonts && document.fonts.ready) {
              try {
                await document.fonts.ready;
              } catch (fontError) {
                console.warn('Failed to wait for fonts before PDF export', fontError);
              }
            }

            updateAllLabels();

            let target = sheet;
            let cleanup = () => {};

            if (!previewVisible && previewWrapper) {
              const clone = sheet.cloneNode(true);
              clone.id = 'tagSheetPdfClone';
              const mount = document.createElement('div');
              mount.style.position = 'fixed';
              mount.style.left = '0';
              mount.style.top = '0';
              mount.style.opacity = '0';
              mount.style.pointerEvents = 'none';
              mount.style.zIndex = '-1';
              mount.appendChild(clone);
              document.body.appendChild(mount);

              clone.querySelectorAll('.price').forEach((priceEl) => {
                applyPriceScaling(priceEl);
              });

              target = clone;
              cleanup = () => {
                mount.remove();
              };
            }

            if (target && target.classList) {
              target.classList.add('is-pdf-export');
            }

            const htmlRoot = document.documentElement;
            const previousScrollX = window.scrollX || window.pageXOffset || 0;
            const previousScrollY = window.scrollY || window.pageYOffset || 0;
            const previousScrollBehavior = htmlRoot ? htmlRoot.style.scrollBehavior : '';

            if (htmlRoot) {
              htmlRoot.style.scrollBehavior = 'auto';
            }

            window.scrollTo(0, 0);

            try {
              const canvas = await html2canvasFn(target, HTML2CANVAS_EXPORT_OPTIONS);
              const imageData = canvas.toDataURL('image/jpeg', 0.98);

              const pdf = new JsPdfConstructor(PDF_PAGE_SETTINGS);
              const pageWidth = pdf.internal.pageSize.getWidth();
              const pageHeight = pdf.internal.pageSize.getHeight();

              pdf.addImage(imageData, 'JPEG', 0, 0, pageWidth, pageHeight, undefined, 'FAST');
              pdf.save(PDF_EXPORT_FILENAME);
            } catch (error) {
              console.error('Failed to generate PDF', error);
              alert('Sorry, there was a problem generating the PDF. Please try again.');
            } finally {
              if (target && target.classList) {
                target.classList.remove('is-pdf-export');
              }
              cleanup();
              window.scrollTo(previousScrollX, previousScrollY);

              if (htmlRoot) {
                htmlRoot.style.scrollBehavior = previousScrollBehavior;
              }
            }
          });
        }

        const printButton = document.getElementById('printSheet');

        if (printButton) {
          printButton.addEventListener('click', () => {
            const shouldHideAfter = !previewVisible;

            const performPrint = () => {
              updateAllLabels();

              try {
                window.print();
              } finally {
                if (shouldHideAfter) {
                  setPreviewVisibility(false);
                }
              }
            };

            if (shouldHideAfter) {
              setPreviewVisibility(true);

              const schedule =
                typeof window.requestAnimationFrame === 'function'
                  ? window.requestAnimationFrame.bind(window)
                  : (callback) => setTimeout(callback, 0);

              schedule(() => {
                schedule(performPrint);
              });
            } else {
              performPrint();
            }
          });
        }
      })();
    </script>
  </body>
</html>
